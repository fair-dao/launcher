# FairdaoFactory 智能合约文档

[查看英文版文档](README.md) | [查看中文版文档](README_CN.md)

## 概述
FairdaoFactory是一个部署在TRON区块链上的智能合约，提供了使用CREATE2操作码部署和管理其他智能合约的强大基础设施。它具有基于角色的访问控制机制，包含超级管理员和普通管理员角色，确保合约部署的安全性和可控性。

## 核心功能

### 1. CREATE2合约部署
- 允许授权管理员使用CREATE2操作码部署新合约
- 基于salt和字节码实现可预测的合约地址
- 确保无论区块号或交易顺序如何，部署结果都是确定性的

### 2. 地址预测
- 提供在部署前预测合约地址的功能
- 对于防止抢跑和需要事先知道地址的高级用例非常有用

### 3. 基于角色的访问控制
- 实现了具有超级管理员和普通管理员角色的多层次权限系统
- 超级管理员拥有完全控制权，包括添加/删除管理员和转移超级管理员权限
- 普通管理员有权部署合约和预测地址

### 4. 管理员管理
- 超级管理员可以通过`addManager`函数添加新管理员
- 超级管理员可以通过`removeManager`函数移除现有管理员
- 防止从管理员列表中移除超级管理员账户

### 5. 超级管理员转移
- 允许当前超级管理员通过`transferSuperAdmin`函数将其角色转移给其他地址
- 自动授予新超级管理员普通管理员身份
- 防止转移给零地址

## 测试方法

FairdaoFactory合约使用Mocha框架进行测试，包括以下测试用例：

### 1. 部署和初始化
- 验证合约以正确的超级管理员部署
- 检查初始权限和状态

### 2. 权限管理
- 测试超级管理员添加和移除管理员的功能
- 验证非超级管理员账户的访问控制
- 确保超级管理员不能被移除为管理员

### 3. 合约部署（CREATE2）
- 测试授权管理员成功部署合约的功能
- 验证地址预测功能
- 验证拒绝非管理员账户的部署请求
- 确保拒绝空字节码部署

### 4. 超级管理员转移
- 验证成功转移超级管理员权限
- 确保新超级管理员获得管理员身份
- 验证拒绝非超级管理员账户的转移请求
- 检查拒绝转移给零地址

### 5. 访问控制修饰符
- 测试`onlySuperAdmin`和`isAdmin`修饰符
- 验证不同用户角色的函数访问权限

## 运行测试
要运行测试，请从项目根目录使用以下命令：
```
npx mocha src/test/FairdaoFactory.test.js --timeout 30000
```